<style lang="less">
@import 'src/common/styles/config.less';
.order-confirm-amount,
.order-confirm-property,
.order-confirm-toolbar,
.order-confirm-consignee,
.order-confirm-contain,
.order-confirm-message{
    padding: @margin;
    margin-top: @margin;
    background-color: @color-maincolor;
}
.order-confirm-consignee{
    margin-top: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}
.order-consignee-side{
    display: block;
    .icon{
        font-size: 40rpx;
    }
    .icon-address{
        color: @color-primary;
    }
    .icon-arrow-right{
        font-size: 60rpx;
    }
}
.order-consignee-main{
    margin-left: @margin;
}
.order-consignee-name{
    margin-right: @margin;
}
.order-consignee-title{
    font-weight: 700;
    font-size: @font-size-large;
}
.order-consignee-address{
    margin-top: @margin/2;
}
.order-confirm-commodity{
    margin-top: 2rpx;
    background-color: @color-maincolor;
}
.order-confirm-amount{
    padding-bottom: 140rpx;
    .freight{
        display: block;
        margin-top: @margin/2;
    }
    .price{
        font-size: @font-size-bigger;
        color: @color-success;
    }
}
.order-confirm-property{
    margin-top: 2rpx;
    line-height: 1.8;
}
.order-confirm-contain{
    flex-grow: 1;
    padding: 0;
    background-color: transparent;
}
.order-confirm-message{
    height: 5.5em;
    line-height: 1.5em;
    padding: @margin/2 @margin;
}
.order-confirm-footer{
}
.order-confirm-toolbar{
    display: block;
    width: 100%;
    height: 100rpx;
    position: fixed;
    bottom: 0;
    left: 0;
    margin: 0;
    padding: 0;
    border-top: 2rpx solid @color-border;
    box-sizing: border-box;
    z-index: 100;
    .price{
        font-size: @font-size-bigger;
        color: @color-success;
    }
    .count{
        flex-grow: 1;
        padding: @margin;
        text-align: right;
    }
    .submit{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        border-radius: 0;
        &:after, &:before{
            border-radius: 0;
        }
    }
}
.order-confirm{
    height: 100%;
}
</style>
<template>
<form report-submit="true" bindsubmit="formSubmit">
    <wxc-flex class="order-confirm" dir="top">
        <view class="order-confirm-consignee" @tap="tapConsignee({{order.consignee.id}})">
            <wxc-cc class="order-consignee-side">
                <text class="icon icon-address"></text>
            </wxc-cc>
            <view class="order-consignee-main" wx:if="{{order.consignee.id}}">
                <view class="order-consignee-title">
                    <text class="order-consignee-name">{{order.consignee.name}}</text>
                    <text class="order-consignee-tel">{{order.consignee.tel}}</text>
                </view>
                <view class="order-consignee-address">
                    <text>收货地址：</text>{{order.consignee.area +' '+ order.consignee.address}}
                </view>
            </view>
            <view class="order-consignee-main" wx:else>
                <view class="order-consignee-title">您还没有收货地址</view>
                <view class="order-consignee-address">请添加先添加收货地址</view>
            </view>
            <wxc-cc class="order-consignee-side">
                <text class="icon icon-arrow-right"></text>
            </wxc-cc>
        </view>
        <view class="order-confirm-contain">
            <repeat for="{{order.commodityList}}" item="commodity" key="cid">
                <orderCommodity :commodity="commodity" class="order-confirm-commodity"></orderCommodity>
            </repeat>
        </view>
        <view class="order-confirm-footer">
            <view class="order-confirm-message">
                <textarea bindinput="bindinput" bindblur="bindinput" bindconfirm="bindinput" value="{{order.message}}" data-type="message" cursor-spacing="20" maxlength="50" placeholder="选填：买家留言（50字以内）"></textarea>
            </view>
            <view class="order-confirm-amount">
                <wxc-flex class="amount" main="between" cross="center">
                    <text>商品总价</text>
                    <wxc-price class="price" value="{{order.totalAmount}}"></wxc-price>
                </wxc-flex>
                <wxc-flex class="freight" main="between" cross="center">
                    <text>运费（满200包邮）</text>
                    <wxc-price class="price" value="{{order.freightAmount}}"></wxc-price>
                </wxc-flex>
            </view>
        </view>
        <wxc-flex class="order-confirm-toolbar">
            <wxc-flex class="count" cross="center" main="end">
                <text>实付款：</text>
                <wxc-price class="price" value="{{order.actualAmount}}"></wxc-price>
            </wxc-flex>
            <button class="submit" type="base" size="bigger" form-type="submit">提交订单</button>
        </wxc-flex>
    </wxc-flex>
</form>
<wxc-popup id="addressPopup">
    <addressList></addressList>
</wxc-popup>
</template>
<script>

import wepy from 'wepy'
import orderCommodity from '@/components/order-commodity'
import addressList from '@/components/address-list'

const __DATA__ = {
    totalAmount: '1149.00',
    freightAmount: '0.00',
    actualAmount: '1149.00',
    message: '帮我包装得好看点',
    consignee: {
        id: 1,
        name: '张生',
        tel: '15817489898',
        area: '广东 广州市  天河区',
        address: '金穗路1号3401(广东星外星唱片)',
    },
    commodityList: [
        {
            id: 1,
            cover: 'https://t1.picb.cc/uploads/2018/02/22/KGQhG.png',
            title: '云之七味',
            type: '熟茶',
            price: 100.00,
            count: 1
        },
        {
            id: 2,
            cover: 'https://t1.picb.cc/uploads/2018/02/22/KGQhG.png',
            title: '云之七味',
            type: '熟茶',
            price: 100.00,
            count: 1
        }
    ]
}

export default class OrderDetail extends wepy.page {
    config = {
        navigationBarTitleText: '订单详情',
        usingComponents: {
            'wxc-cc': '/packages/@minui/wxc-cc/dist/index',
            'wxc-flex': '/packages/@minui/wxc-flex/dist/index',
            'wxc-avatar': '/packages/@minui/wxc-avatar/dist/index',
            'wxc-badge': '/packages/@minui/wxc-badge/dist/index',
            'wxc-elip': '/packages/@minui/wxc-elip/dist/index',
            'wxc-icon': '/packages/@minui/wxc-icon/dist/index',
            'wxc-label': '/packages/@minui/wxc-label/dist/index',
            'wxc-loadmore': '/packages/@minui/wxc-loadmore/dist/index',
            'wxc-price': '/packages/@minui/wxc-price/dist/index',

            'wxc-abnor': '/packages/@minui/wxc-abnor/dist/index',
            'wxc-countdown': '/packages/@minui/wxc-countdown/dist/index',
            'wxc-counter': '/packages/@minui/wxc-counter/dist/index',
            'wxc-loading': '/packages/@minui/wxc-loading/dist/index',
            'wxc-mask': '/packages/@minui/wxc-mask/dist/index',
            'wxc-steps': '/packages/@minui/wxc-steps/dist/index',
            'wxc-tab': '/packages/@minui/wxc-tab/dist/index',
            'wxc-tab-panel': '/packages/@minui/wxc-tab/dist/panel',
            'wxc-tab-label': '/packages/@minui/wxc-tab/dist/label',

            'wxc-dialog': '/packages/@minui/wxc-dialog/dist/index',
            'wxc-popup': '/packages/@minui/wxc-popup/dist/index',
            'wxc-toast': '/packages/@minui/wxc-toast/dist/index'
        }
    }

    components = {
        addressList,
        orderCommodity
    }

    mixins = []

    data = {
        order: __DATA__
    }

    computed = {
    }

    methods = {
        bindinput(e){
            const { type } = e.currentTarget.dataset;
            let message = e.detail.value && e.detail.value.replace(/[\s\r\n]+/g, ' ') || '';
            this.order[type] = message
        },

        tapConsignee(id){
            // let popup = this.$wxpage.selectComponent('#addressPopup');
            // popup && popup.show();
            wx.navigateTo({
                url: `/pages/address/list?sid=${id}&type=select`
            })
        },

        formSubmit(e){
            console.log(e.detail.formId)
        }
    }

    events = {

    }

    onLoad(res) {
        console.log(res)
    }

    onShow(res) {
        wx.st
    }
}

</script>
