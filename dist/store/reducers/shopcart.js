"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Object.defineProperty(exports,"__esModule",{value:!0});var _handleActions,_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_reduxActions=require("./../../npm/redux-actions/lib/index.js"),_shopcart=require("./../types/shopcart.js"),SHOP_BUY_LIST="SHOP_BUY_LIST",SHOP_CART_LIST="SHOP_CART_LIST",initState={shopCartData:[],shopCartList:[],shopBuyList:[],isSelectedAll:!1,totalAmount:0},getSelectStatus=function(t){try{return!t.every(function(t){return 0==t.isSelected})}catch(t){}},getTotalAmount=function(t){try{var e=0;return t.forEach(function(t){var r=NaN!=Number(t.price)?Number(t.price):0,a=NaN!=Number(t.count)?Number(t.count):0;t.isSelected&&(e+=r*a)}),e.toFixed(2)}catch(t){}},todos=(0,_reduxActions.handleActions)((_handleActions={},_defineProperty(_handleActions,_shopcart.GET_SHOP_CART,function(t,e){var r=(e.type,e.payload),a=Array.from(new Set(t.shopCartData.concat(_wepy2.default.getStorageSync(SHOP_CART_LIST)||[]))),n=Array.from(new Set(a.filter(function(t){return t.uid==r.uid}))),o=getSelectStatus(n),i=getTotalAmount(n);return _extends({},t,{shopCartData:a,shopCartList:n,isSelectedAll:o,totalAmount:i})}),_defineProperty(_handleActions,_shopcart.SET_SHOP_CART,function(t,e){var r=(e.type,e.payload),a=t.shopCartData.concat();try{a=a.map(function(t){return t.uid==r.uid&&t.id==r.id&&(t=r),t})}catch(t){}var n=a.filter(function(t){return t.uid==r.uid}),o=getSelectStatus(n),i=getTotalAmount(n);return _wepy2.default.setStorageSync(SHOP_CART_LIST,a),_extends({},t,{shopCartData:a,shopCartList:n,isSelectedAll:o,totalAmount:i})}),_defineProperty(_handleActions,_shopcart.DEL_SHOP_CART,function(t,e){var r=(e.type,e.payload),a=t.shopCartData.concat();try{var n=a.findIndex(function(t){return t.uid==r.uid&&t.id==r.id});a.splice(n,1)}catch(t){}var o=a.filter(function(t){return t.uid==r.uid}),i=getSelectStatus(o),u=getTotalAmount(o);return _wepy2.default.setStorageSync(SHOP_CART_LIST,a),_extends({},t,{shopCartData:a,shopCartList:o,isSelectedAll:i,totalAmount:u})}),_defineProperty(_handleActions,_shopcart.ADD_SHOP_CART,function(t,e){var r=(e.type,e.payload),a=t.shopCartData.concat();try{var n=a.findIndex(function(t){return t.id==r.id&&t.uid==r.uid});n>-1?a[n]=Object.assign({},a[n],r,{count:a[n].count+r.count}):a.push(r)}catch(t){}var o=a.filter(function(t){return t.uid==r.uid}),i=getSelectStatus(o),u=getTotalAmount(o);return _wepy2.default.setStorageSync(SHOP_CART_LIST,a),_extends({},t,{shopCartData:a,shopCartList:o,isSelectedAll:i,totalAmount:u})}),_defineProperty(_handleActions,_shopcart.CHECK_ONE_SHOP_CART,function(t,e){var r=(e.type,e.payload),a=t.shopCartData.concat();try{a=a.map(function(t){return t.uid==r.uid&&t.id==r.id&&(t.isSelected=!t.isSelected),t})}catch(t){}var n=a.filter(function(t){return t.uid==r.uid}),o=getSelectStatus(n),i=getTotalAmount(n);return _wepy2.default.setStorageSync(SHOP_CART_LIST,a),_extends({},t,{shopCartData:a,shopCartList:n,isSelectedAll:o,totalAmount:i})}),_defineProperty(_handleActions,_shopcart.CHECK_ALL_SHOP_CART,function(t,e){var r=(e.type,e.payload),a=t.shopCartData.concat(),n=!t.isSelectedAll;try{a=a.map(function(t){return t.uid==r.uid&&(t.isSelected=n),t})}catch(t){}var o=a.filter(function(t){return t.uid==r.uid}),i=getTotalAmount(o);return _wepy2.default.setStorageSync(SHOP_CART_LIST,a),_extends({},t,{shopCartData:a,shopCartList:o,isSelectedAll:n,totalAmount:i})}),_defineProperty(_handleActions,_shopcart.GET_BUY_LIST,function(t,e){var r=(e.type,e.payload,t.shopCartList.concat()),a=t.shopBuyList||[];try{a=r.filter(function(t){return t.isSelected})}catch(t){}return _wepy2.default.setStorageSync(SHOP_BUY_LIST,a),_extends({},t,{shopBuyList:a})}),_handleActions),initState);exports.default=todos;